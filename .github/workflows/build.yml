name: Build RootHide Bootstrap
on: 
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          submodules: recursive #

      - name: Install Theos and SDKs
        run: |
          # Install Theos with RootHide support
          bash -c "$(curl -fsSL https://raw.githubusercontent.com/roothide/theos/master/bin/install-theos)"
          
          # Download a standard iOS SDK needed for building
          curl -L https://github.com/theos/sdks/raw/master/iPhoneOS16.5.sdk.tar.xz -o $HOME/theos/sdks/iPhoneOS16.5.sdk.tar.xz
          tar -xf $HOME/theos/sdks/iPhoneOS16.5.sdk.tar.xz -C $HOME/theos/sdks/
          
          echo "THEOS=$HOME/theos" >> $GITHUB_ENV

      - name: Compile Bootstrap
        run: |
          export THEOS=$HOME/theos
          make package FINALPACKAGE=1 #
        
      - name: Save Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Bootstrap-Build
          path: packages/*.tipa
